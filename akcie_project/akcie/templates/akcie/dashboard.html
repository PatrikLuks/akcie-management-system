{% extends 'akcie/base.html' %}

{% block content %}
<h1>Dashboard</h1>
<form method="get" action="">
  <input type="text" name="q" placeholder="Hledat..." value="{{ query|default_if_none:'' }}">
  <button type="submit">Filtrovat</button>
</form>
<div class="dashboard-grid">
  <div>
    <h2>Počet akcií</h2>
    <p>{{ total_akcie }}</p>
  </div>
  <div>
    <h2>Počet transakcí</h2>
    <p>{{ total_transakce }}</p>
  </div>
  <div>
    <h2>Celková částka dividend</h2>
    <p>{{ total_dividendy }} Kč</p>
  </div>
  <div>
    <h2>Celková hodnota investic</h2>
    <p>{{ total_hodnota }} Kč</p>
  </div>
  <div>
    <h2>Celkový zisk/ztráta</h2>
    <p>{{ total_zisk_ztrata }} Kč</p>
  </div>
</div>
<div>
  <canvas id="dividendyChart" width="400" height="200"></canvas>
  <canvas id="transakceChart" width="400" height="200"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function luxGold(i) {
  const palette = ['#bfa14a', '#fff', '#181818', '#232323'];
  return palette[i % palette.length];
}
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('dividendyChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Dividendy'],
            datasets: [{
                label: 'Celková částka dividend',
                data: [{{ total_dividendy }}],
                backgroundColor: luxGold(0),
                borderColor: luxGold(1),
                borderWidth: 2
            }]
        },
        options: {
            plugins: { legend: { labels: { color: luxGold(1) } } },
            scales: { x: { ticks: { color: luxGold(1) } }, y: { ticks: { color: luxGold(1) } } }
        }
    });
    const transakceCtx = document.getElementById('transakceChart').getContext('2d');
    new Chart(transakceCtx, {
        type: 'pie',
        data: {
            labels: {{ transakce_typy|map(attribute='typ')|join:","|safe }},
            datasets: [{
                label: 'Počet transakcí',
                data: {{ transakce_typy|map(attribute='count')|join:","|safe }},
                backgroundColor: [luxGold(0), luxGold(1), luxGold(2), luxGold(3)],
                borderColor: luxGold(1),
                borderWidth: 2
            }]
        },
        options: { plugins: { legend: { labels: { color: luxGold(1) } } } }
    });
});
</script>
{% endblock %}
